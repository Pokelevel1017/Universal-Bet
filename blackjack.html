<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal-Bet | Blackjack</title>
    <style>
        :root { 
            --dark-blue: #0b1120; --mid-blue: #1e293b; --light-blue: #38bdf8; 
            --accent-green: #00e701; --card-bg: #111827; --text-muted: #94a3b8;
            --premium-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --felt-green: #064e3b; --danger-red: #ef4444; --hot-orange: #fb923c;
        }

        body { background-color: var(--dark-blue); color: white; font-family: 'Inter', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* NAV & SIDEBAR */
        nav { background: #070b14; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; height: 75px; border-bottom: 1px solid var(--mid-blue); flex-shrink: 0; z-index: 100; }
        .logo { font-size: 1.5rem; font-weight: 900; letter-spacing: -1px; cursor: pointer; }
        .logo span { color: var(--light-blue); }
        .balance-box { background: var(--mid-blue); padding: 10px 20px; border-radius: 8px; font-weight: 800; color: var(--accent-green); border: 1px solid rgba(56, 189, 248, 0.2); font-size: 1.1rem; }

        .main-content { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 280px; background: #070b14; border-right: 1px solid var(--mid-blue); padding: 20px 12px; display: flex; flex-direction: column; gap: 6px; flex-shrink: 0; overflow-y: auto; }
        .sidebar-label { font-size: 11px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; margin: 20px 0 10px 15px; letter-spacing: 1px; }
        .side-link { padding: 12px 15px; border-radius: 8px; color: var(--text-muted); text-decoration: none; font-weight: 600; transition: 0.2s; display: flex; align-items: center; gap: 12px; font-size: 14px; }
        .side-link:hover, .active-link { background: var(--mid-blue); color: white; }

        /* GAME AREA */
        .game-area { flex: 1; padding: 40px; display: flex; flex-direction: column; align-items: center; background: radial-gradient(circle at top left, #1e293b, #0b1120); position: relative; overflow-y: auto; }
        .table-surface { width: 100%; max-width: 900px; height: 500px; background: var(--felt-green); border-radius: 200px 200px 40px 40px; border: 12px solid #3d2b1f; box-shadow: inset 0 0 120px rgba(0,0,0,0.6), 0 25px 50px rgba(0,0,0,0.5); display: flex; flex-direction: column; justify-content: space-around; align-items: center; position: relative; }

        .hands-container { display: flex; gap: 50px; align-items: flex-end; }
        .hand-wrapper { display: flex; flex-direction: column; align-items: center; gap: 10px; transition: 0.3s; }
        .active-hand { transform: scale(1.1); filter: drop-shadow(0 0 15px var(--accent-green)); }
        
        .card-row { display: flex; gap: -30px; height: 120px; justify-content: center; min-width: 100px; }
        
        .card { 
            width: 80px; height: 110px; background: white; border-radius: 8px; color: black; padding: 8px; 
            font-weight: 900; font-size: 1.2rem; display: flex; flex-direction: column; justify-content: space-between;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.4); border: 1px solid #ddd;
            animation: cardDeal 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0;
        }
        @keyframes cardDeal { 0% { transform: translateY(-300px) rotate(-45deg); opacity: 0; } 100% { transform: translateY(0) rotate(0); opacity: 1; } }
        .card.red { color: #ef4444; }
        .card.hidden { background: var(--premium-gradient); border: 2px solid var(--light-blue); color: transparent; }

        .action-bar { margin-top: 35px; display: flex; flex-direction: column; align-items: center; gap: 20px; width: 100%; }
        .bet-box { display: flex; align-items: center; gap: 15px; background: var(--card-bg); padding: 12px 25px; border-radius: 15px; border: 1px solid var(--mid-blue); }
        .bet-box input { background: transparent; border: none; color: white; font-size: 1.5rem; font-weight: 900; width: 120px; text-align: center; outline: none; }
        
        .btn-group { display: flex; gap: 12px; }
        .btn { padding: 14px 28px; border-radius: 10px; border: none; font-weight: 900; text-transform: uppercase; cursor: pointer; transition: 0.2s; font-size: 13px; }
        .btn-deal { background: var(--light-blue); color: var(--dark-blue); }
        .btn-hit { background: var(--mid-blue); color: white; border: 1px solid var(--light-blue); }
        .btn-stand { background: var(--danger-red); color: white; }
        .btn-extra { background: var(--hot-orange); color: var(--dark-blue); }
        .btn:disabled { opacity: 0.3; cursor: not-allowed; }

        .status-overlay { position: absolute; top: 40%; font-size: 4rem; font-weight: 900; text-shadow: 0 0 30px black; z-index: 100; pointer-events: none; display: none; text-align: center; width: 100%; animation: popIn 0.4s ease; }
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<nav>
    <div class="logo" onclick="location.href='index.html'">UNIVERSAL<span>-BET</span></div>
    <div class="balance-box"><span id="navBal">$0.00</span></div>
</nav>

<div class="main-content">
    <aside class="sidebar">
        <a href="index.html" class="side-link"><span>üè†</span> Home</a>
        <div class="sidebar-label">Games</div>
        <a href="blackjack.html" class="side-link active-link"><span>üÉè</span> Blackjack</a>
        <a href="dice.html" class="side-link"><span>üé≤</span> Dice</a>
        <a href="mines.html" class="side-link"><span>üí£</span> Mines</a>
        <a href="rps.html" class="side-link"><span>‚úä</span> Rock Paper Scissors</a>
        <a href="tower.html" class="side-link"><span>üóº</span> Tower</a>
    </aside>

    <main class="game-area">
        <div class="status-overlay" id="statusOverlay"></div>

        <div class="table-surface">
            <div class="hand-wrapper">
                <div class="card-row" id="dealerCards"></div>
            </div>

            <div class="hands-container" id="playerHandsContainer">
                <div class="hand-wrapper active-hand" id="hand0">
                    <div class="card-row" id="playerCards0"></div>
                </div>
            </div>
        </div>

        <div class="action-bar">
            <div class="bet-box" id="betControls">
                <span style="color:var(--accent-green); font-weight:900;">$</span>
                <input type="number" id="betAmount" value="10" min="1">
                <button class="btn btn-deal" onclick="startDeal()">Place Bet & Deal</button>
            </div>

            <div class="btn-group" id="gameControls" style="display: none;">
                <button class="btn btn-hit" onclick="hit()">Hit</button>
                <button class="btn btn-stand" onclick="stand()">Stand</button>
                <button class="btn btn-extra" id="doubleBtn" onclick="doubleDown()">Double</button>
                <button class="btn btn-extra" id="splitBtn" onclick="split()" style="display: none;">Split</button>
            </div>
        </div>
    </main>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDAr9GqIDPWGw0ojEYPL1eigfMeqTGsfT0",
        authDomain: "universalbet-427ce.firebaseapp.com",
        databaseURL: "https://universalbet-427ce-default-rtdb.firebaseio.com",
        projectId: "universalbet-427ce",
        storageBucket: "universalbet-427ce.firebasestorage.app",
        messagingSenderId: "804592033030",
        appId: "1:804592033030:web:352d7f4e8a75fb3f215287"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let user = JSON.parse(localStorage.getItem('currentUser'));

    let deck = [], hands = [[]], dealerHand = [], activeHand = 0, bet = 0, isGameOver = false;

    function init() {
        if (!user) return window.location.href = 'index.html';
        db.ref('users/' + user.name).on('value', s => {
            user = s.val();
            document.getElementById('navBal').innerText = `$${user.balance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
        });
    }

    function createDeck() {
        const suits = ['‚ô†', '‚ô£', '‚ô•', '‚ô¶'], vals = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
        deck = []; suits.forEach(s => vals.forEach(v => deck.push({s, v, r: s==='‚ô•'||s==='‚ô¶'})));
        deck.sort(() => Math.random() - 0.5);
    }

    function getVal(hand) {
        let v = 0, a = 0;
        hand.forEach(c => { if(c.v==='A') a++; else if(['J','Q','K'].includes(c.v)) v+=10; else v+=parseInt(c.v); });
        for(let i=0; i<a; i++) v += (v+11<=21) ? 11 : 1;
        return v;
    }

    function renderCard(card, targetId, hidden = false, delay = 0) {
        setTimeout(() => {
            const el = document.createElement('div');
            el.className = `card ${card.r ? 'red' : ''} ${hidden ? 'hidden' : ''}`;
            if(!hidden) el.innerHTML = `<div>${card.v}</div><div style="font-size:2rem;align-self:center">${card.s}</div><div style="align-self:flex-end;transform:rotate(180deg)">${card.v}</div>`;
            const container = document.getElementById(targetId);
            if(container) container.appendChild(el);
        }, delay);
    }

    function startDeal() {
        bet = parseFloat(document.getElementById('betAmount').value);
        if (bet > user.balance || bet <= 0) return alert("Insufficient Funds");
        db.ref('users/'+user.name).update({ balance: user.balance - bet });
        
        hands = [[]]; dealerHand = []; activeHand = 0; isGameOver = false;
        
        document.getElementById('playerHandsContainer').innerHTML = '<div class="hand-wrapper active-hand" id="hand0"><div class="card-row" id="playerCards0"></div></div>';
        document.getElementById('dealerCards').innerHTML = '';
        document.getElementById('statusOverlay').style.display = 'none';
        document.getElementById('betControls').style.display = 'none';
        document.getElementById('gameControls').style.display = 'flex';

        createDeck();
        hands[0].push(deck.pop(), deck.pop());
        dealerHand.push(deck.pop(), deck.pop());

        renderCard(hands[0][0], 'playerCards0', false, 0);
        renderCard(dealerHand[0], 'dealerCards', false, 200);
        renderCard(hands[0][1], 'playerCards0', false, 400);
        renderCard(dealerHand[1], 'dealerCards', true, 600);

        setTimeout(() => {
            const s = getVal(hands[0]);
            if (s === 21) return endRound("BLACKJACK!", bet * 2.5);
            document.getElementById('doubleBtn').style.display = 'inline-block';
            document.getElementById('splitBtn').style.display = (hands[0][0].v === hands[0][1].v) ? 'inline-block' : 'none';
        }, 700);
    }

    function hit() {
        if(isGameOver) return;
        const card = deck.pop();
        hands[activeHand].push(card);
        renderCard(card, `playerCards${activeHand}`);
        
        document.getElementById('doubleBtn').style.display = 'none';
        document.getElementById('splitBtn').style.display = 'none';

        setTimeout(() => {
            const s = getVal(hands[activeHand]);
            if(s === 21) {
                endRound("21! AUTO-WIN", bet * 2);
            } else if(s > 21) {
                (hands.length > 1 && activeHand === 0) ? nextHand() : stand();
            }
        }, 100);
    }

    function doubleDown() {
        if (user.balance < bet) return alert("Insufficient Funds");
        db.ref('users/'+user.name).update({ balance: user.balance - bet });
        bet *= 2;
        hit();
        if(!isGameOver) setTimeout(stand, 600);
    }

    function split() {
        if (user.balance < bet) return alert("Insufficient Funds");
        db.ref('users/'+user.name).update({ balance: user.balance - bet });
        const card = hands[0].pop();
        hands.push([card]);
        
        document.getElementById('playerHandsContainer').innerHTML += '<div class="hand-wrapper" id="hand1"><div class="card-row" id="playerCards1"></div></div>';
        document.getElementById('playerCards0').innerHTML = '';
        renderCard(hands[0][0], 'playerCards0');
        renderCard(hands[1][0], 'playerCards1');
        document.getElementById('splitBtn').style.display = 'none';
    }

    function nextHand() {
        document.getElementById('hand0').classList.remove('active-hand');
        activeHand = 1;
        document.getElementById('hand1').classList.add('active-hand');
    }

    function stand() {
        if (isGameOver) return;
        if (hands.length > 1 && activeHand === 0) return nextHand();
        
        isGameOver = true;
        document.getElementById('dealerCards').innerHTML = '';
        dealerHand.forEach((c, i) => renderCard(c, 'dealerCards', false, i * 200));
        
        setTimeout(() => {
            let ds = getVal(dealerHand);
            while(ds < 17) {
                const c = deck.pop(); dealerHand.push(c);
                renderCard(c, 'dealerCards', false, (dealerHand.length-1) * 200);
                ds = getVal(dealerHand);
            }

            let totalWin = 0;
            let resultType = "DEALER WINS";

            hands.forEach(h => {
                const ps = getVal(h);
                if (ps <= 21) {
                    if (ds > 21 || ps > ds) {
                        totalWin += bet * 2;
                        resultType = "YOU WIN!";
                    } else if (ps === ds) {
                        totalWin += bet;
                        resultType = "TIE - PUSH";
                    }
                }
            });

            const status = document.getElementById('statusOverlay');
            status.innerText = resultType;
            status.style.color = resultType === "YOU WIN!" ? 'var(--accent-green)' : (resultType === "TIE - PUSH" ? 'white' : 'var(--danger-red)');
            status.style.display = 'block';

            if(totalWin > 0) db.ref('users/'+user.name).update({ balance: user.balance + totalWin });

            setTimeout(() => {
                document.getElementById('betControls').style.display = 'flex';
                document.getElementById('gameControls').style.display = 'none';
            }, 2000);
        }, 600);
    }

    function endRound(msg, payout) {
        isGameOver = true;
        const status = document.getElementById('statusOverlay');
        status.innerText = msg;
        status.style.color = 'var(--accent-green)';
        status.style.display = 'block';
        db.ref('users/'+user.name).update({ balance: user.balance + payout });
        setTimeout(() => {
            document.getElementById('betControls').style.display = 'flex';
            document.getElementById('gameControls').style.display = 'none';
        }, 2000);
    }

    init();
</script>
</body>
</html>
