<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal-Bet | Home</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --dark-blue: #0b1120; --mid-blue: #1e293b; --light-blue: #38bdf8; 
            --accent-green: #00e701; --card-bg: #111827; --text-muted: #94a3b8;
            --premium-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --modal-bg: #0f172a;
        }

        body { background-color: var(--dark-blue); color: white; font-family: 'Inter', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* NAVIGATION */
        nav { background: #070b14; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; height: 75px; border-bottom: 1px solid var(--mid-blue); flex-shrink: 0; z-index: 100; }
        .logo { font-size: 1.5rem; font-weight: 900; letter-spacing: -1px; cursor: pointer; }
        .logo span { color: var(--light-blue); }
        .nav-right { display: flex; align-items: center; gap: 12px; }
        .header-reward-box { background: rgba(56, 189, 248, 0.1); border: 1px solid rgba(56, 189, 248, 0.2); padding: 8px 15px; border-radius: 8px; display: none; align-items: center; gap: 10px; cursor: pointer; transition: 0.2s; }
        .reward-timer-text { font-size: 11px; font-weight: 800; color: var(--light-blue); text-transform: uppercase; }
        .balance-box { background: var(--mid-blue); padding: 10px 20px; border-radius: 8px; font-weight: 800; color: var(--accent-green); display: flex; align-items: center; gap: 10px; font-size: 1.1rem; border: 1px solid rgba(56, 189, 248, 0.2); visibility: hidden; }

        /* LAYOUT */
        .main-content { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 280px; background: #070b14; border-right: 1px solid var(--mid-blue); padding: 20px 12px; display: flex; flex-direction: column; gap: 6px; flex-shrink: 0; overflow-y: auto; }
        .sidebar-label { font-size: 11px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; margin: 20px 0 10px 15px; letter-spacing: 1px; }
        .side-link { padding: 12px 15px; border-radius: 8px; color: var(--text-muted); text-decoration: none; font-weight: 600; transition: 0.2s; display: flex; align-items: center; gap: 12px; font-size: 14px; }
        .side-link:hover, .active-link { background: var(--mid-blue); color: white; }

        /* DASHBOARD CONTENT */
        .dashboard { flex: 1; padding: 40px; overflow-y: auto; background: radial-gradient(circle at top left, #1e293b, #0b1120); }
        .status-header { margin-bottom: 30px; }
        .status-header h1 { font-size: 2.2rem; font-weight: 900; margin: 0; }
        .highlight { color: var(--light-blue); }

        /* TABS */
        .tab-nav { display: flex; gap: 10px; border-bottom: 1px solid var(--mid-blue); margin-bottom: 30px; }
        .tab-btn { padding: 12px 24px; background: none; border: none; color: var(--text-muted); font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 13px; border-bottom: 2px solid transparent; transition: 0.2s; }
        .tab-btn.active { color: var(--light-blue); border-bottom-color: var(--light-blue); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* NEWS TAB */
        .news-container { display: grid; grid-template-columns: 1fr 350px; gap: 30px; align-items: stretch; }
        @media (max-width: 1000px) { .news-container { grid-template-columns: 1fr; } }
        .news-main { display: flex; flex-direction: column; gap: 20px; }
        .news-card { background: var(--card-bg); border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); padding: 25px; transition: 0.3s; position: relative; flex: 1; }
        .news-card:hover { border-color: var(--light-blue); background: #161f2e; }
        .news-tag { font-size: 10px; font-weight: 900; padding: 4px 8px; border-radius: 4px; text-transform: uppercase; margin-bottom: 15px; display: inline-block; }
        .tag-update { background: rgba(56, 189, 248, 0.2); color: var(--light-blue); }
        .tag-live { background: rgba(0, 231, 1, 0.2); color: var(--accent-green); animation: pulse 2s infinite; }
        .news-title { font-size: 1.4rem; font-weight: 900; margin: 10px 0; }
        .news-excerpt { color: var(--text-muted); line-height: 1.6; font-size: 14px; }

        /* LIVE FEED */
        .live-feed { background: var(--card-bg); border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); padding: 25px; display: flex; flex-direction: column; height: 450px; }
        .feed-scroll { flex: 1; overflow-y: auto; scrollbar-width: none; }
        .feed-scroll::-webkit-scrollbar { display: none; }
        .feed-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; animation: slideIn 0.4s ease-out; }
        .feed-user { font-weight: 800; color: white; }
        .feed-amount { color: var(--accent-green); font-weight: 900; }

        @keyframes slideIn { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* LEADERBOARD TABLE */
        .leaderboard-table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 12px; overflow: hidden; border: 1px solid var(--mid-blue); }
        .leaderboard-table th { background: #070b14; padding: 18px; color: var(--text-muted); text-align: left; font-size: 11px; text-transform: uppercase; }
        .leaderboard-table td { padding: 18px; border-top: 1px solid var(--mid-blue); font-size: 14px; }
        .bal-cell { color: var(--accent-green); font-weight: 900; text-align: right; font-family: monospace; font-size: 1.1rem; }
        .rank-badge { font-weight: 900; color: white; background: var(--mid-blue); padding: 4px 10px; border-radius: 6px; }
        .rank-1 { background: #fbbf24; color: #000; }
        .rank-2 { background: #94a3b8; color: #000; }
        .rank-3 { background: #92400e; color: #fff; }

        /* ABOUT BOX */
        .about-box { background: var(--card-bg); padding: 30px; border-radius: 16px; border: 1px solid var(--mid-blue); line-height: 1.8; }

        /* LOGIN MODAL */
        .modal-overlay { position: fixed; inset: 0; background: rgba(2, 6, 23, 0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(8px); }
        .modal { background: #0f172a; padding: 50px 40px; border-radius: 28px; width: 100%; max-width: 420px; border: 1px solid rgba(56, 189, 248, 0.3); text-align: center; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); position: relative; }
        .modal h2 { font-size: 1.8rem; font-weight: 900; margin: 20px 0 10px; }
        .modal p { color: var(--text-muted); font-size: 14px; margin-bottom: 30px; }
        .modal-icon-container { width: 80px; height: 80px; background: rgba(56, 189, 248, 0.1); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto; border: 1px solid rgba(56, 189, 248, 0.2); }
        .modal input { width: 100%; padding: 16px; border-radius: 12px; border: 2px solid #1e293b; background: #070b14; color: white; font-weight: 600; font-size: 16px; outline: none; transition: 0.2s; box-sizing: border-box; }
        .modal input:focus { border-color: var(--light-blue); background: #0b1120; box-shadow: 0 0 15px rgba(56, 189, 248, 0.2); }
        .btn-submit { width: 100%; background: var(--light-blue); color: var(--dark-blue); padding: 16px; border-radius: 12px; font-weight: 900; text-transform: uppercase; cursor: pointer; border: none; margin-top: 20px; transition: 0.3s; }
        .btn-submit:hover { background: #7dd3fc; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(56, 189, 248, 0.3); }

        .footer { text-align: center; padding: 40px 0; color: #475569; font-weight: 700; font-size: 10px; letter-spacing: 2px; }
    </style>
</head>
<body>

<nav>
    <div class="logo" onclick="location.href='index.html'">UNIVERSAL<span>-BET</span></div>
    <div class="nav-right">
        <div class="header-reward-box" id="headerReward" onclick="claimBonus()">
            <span class="reward-icon">üéÅ</span>
            <span id="headerTimer" class="reward-timer-text">Loading...</span>
        </div>
        <div class="balance-box" id="balanceDisplay"><span id="navBal">$0.00</span></div>
    </div>
</nav>

<div class="main-content">
    <aside class="sidebar">
        <a href="index.html" class="side-link active-link"><span>üè†</span> Home</a>
        <div class="sidebar-label">Games</div>
        <a href="blackjack.html" class="side-link"><span>üÉè</span> Blackjack</a>
        <a href="dice.html" class="side-link"><span>üé≤</span> Dice</a>
        <a href="mines.html" class="side-link"><span>üí£</span> Mines</a>
        <a href="rps.html" class="side-link"><span>‚úä</span> Rock Paper Scissors</a>
        <a href="tower.html" class="side-link"><span>üóº</span> Tower</a>
    </aside>

    <main class="dashboard">
        <div class="status-header" id="headerContent">
            <h1>Welcome to <span class="highlight">Universal-Bet</span></h1>
            <p>Ready to get on that leaderboard???</p>
        </div>

        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('news')">Latest News</button>
            <button class="tab-btn" onclick="switchTab('leaderboard')">Leaderboard</button>
            <button class="tab-btn" onclick="switchTab('about')">About</button>
        </div>

        <div id="news" class="tab-content active">
            <div class="news-container">
                <div class="news-main">
                    <div class="news-card">
                        <span class="news-tag tag-update">Data</span>
                        <h2 class="news-title">Real-Time Cloud Sync</h2>
                        <p class="news-excerpt">Our database now handles thousands of concurrent wins. Your balance and rankings update across all your devices instantly.</p>
                    </div>
                    <div class="news-card">
                        <span class="news-tag tag-update">Notice</span>
                        <h2 class="news-title">Dont like the games we have?</h2>
                        <p class="news-excerpt">If you dont like the games we have dont worry! I update this site every week with new games!</p>
                    </div>
                </div>

                <div class="live-feed">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="font-size:12px; text-transform:uppercase; letter-spacing:1px; margin:0;">Live Feed</h3>
                        <span class="news-tag tag-live" style="margin:0;">Live</span>
                    </div>
                    <div id="liveJackpotFeed" class="feed-scroll">
                        <div class="feed-item" style="color: var(--text-muted)">Connecting...</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="leaderboard" class="tab-content">
            <table class="leaderboard-table">
                <thead>
                    <tr><th>Rank</th><th>Player</th><th style="text-align: right;">Total Balance</th></tr>
                </thead>
                <tbody id="leaderboardBody"></tbody>
            </table>
        </div>

        <div id="about" class="tab-content">
            <div class="about-box">
                <h3>üèÜ Universal-Bet</h3>
                <p>A secure, real-time fake gambling platform with a competitive leaderboard.</p>
                <p>Developed by <b>FUSIONZZZ</b>.</p>
                <p>Version 1.0 - New website!</p>
            </div>
        </div>

        <div class="footer">WEBSITE MADE BY FUSIONZZZ</div>
    </main>
</div>

<div class="modal-overlay" id="modalOverlay" style="display:none">
    <div class="modal">
        <div class="modal-icon-container">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#38bdf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        </div>
        <h2>Access Account</h2>
        <p>Enter your username to sync your progress.</p>
        <input type="text" id="usernameInput" placeholder="Username" autocomplete="off">
        <button class="btn-submit" onclick="handleAuth()">Confirm Identity</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDAr9GqIDPWGw0ojEYPL1eigfMeqTGsfT0",
        authDomain: "universalbet-427ce.firebaseapp.com",
        databaseURL: "https://universalbet-427ce-default-rtdb.firebaseio.com",
        projectId: "universalbet-427ce",
        storageBucket: "universalbet-427ce.firebasestorage.app",
        messagingSenderId: "804592033030",
        appId: "1:804592033030:web:352d7f4e8a75fb3f215287"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentLocalUser = null;
    let lastKnownBalances = {}; 

    function checkAuth() {
        const localUser = JSON.parse(localStorage.getItem('currentUser'));
        if (localUser && localUser.name) {
            db.ref('users/' + localUser.name.toLowerCase()).once('value', (snap) => {
                if(snap.exists()){
                    currentLocalUser = snap.val();
                    startLiveSync();
                    initPersistentFeed(); 
                } else {
                    localStorage.removeItem('currentUser');
                    document.getElementById('modalOverlay').style.display = 'flex';
                }
            });
        } else {
            document.getElementById('modalOverlay').style.display = 'flex';
        }
    }

    function handleAuth() {
        const nameInput = document.getElementById('usernameInput').value.trim();
        if (nameInput.length < 3) return alert("Min 3 characters");
        const name = nameInput.toLowerCase().replace(/[^a-z0-9]/g, "");

        db.ref('users/' + name).once('value').then((snap) => {
            if (snap.exists()) {
                localStorage.setItem('currentUser', JSON.stringify(snap.val()));
            } else {
                const newUser = { name: name, balance: 100.00, lastBonus: 0 };
                db.ref('users/' + name).set(newUser);
                localStorage.setItem('currentUser', JSON.stringify(newUser));
            }
            location.reload();
        });
    }

    function startLiveSync() {
        db.ref('users/' + currentLocalUser.name.toLowerCase()).on('value', (snap) => {
            if (snap.exists()) {
                currentLocalUser = snap.val();
                updateUI(currentLocalUser);
            }
        });
    }

    // FEED CLEANER (DELETES WINS > 24H OLD)
    function cleanupOldWins() {
        const cutoff = Date.now() - (24 * 60 * 60 * 1000);
        db.ref('recent_wins').orderByChild('timestamp').endAt(cutoff).once('value', (snap) => {
            snap.forEach(child => { child.ref.remove(); });
        });
    }

    function initPersistentFeed() {
        cleanupOldWins();
        const feedRef = db.ref('recent_wins');
        
        // Push local wins to server
        db.ref('users').on('value', (snap) => {
            snap.forEach(child => {
                const user = child.val();
                const userId = user.name.toLowerCase();
                const newBal = user.balance;
                const oldBal = lastKnownBalances[userId];
                if (oldBal !== undefined && newBal > oldBal) {
                    feedRef.push({ name: user.name.toUpperCase(), amount: newBal - oldBal, timestamp: Date.now() });
                }
                lastKnownBalances[userId] = newBal;
            });
        });

        // Display shared feed
        feedRef.limitToLast(12).on('value', (snap) => {
            const feedContainer = document.getElementById('liveJackpotFeed');
            feedContainer.innerHTML = "";
            let wins = [];
            snap.forEach(child => { wins.push(child.val()); });
            wins.reverse().forEach(win => {
                const item = document.createElement('div');
                item.className = 'feed-item';
                item.innerHTML = `<span class="feed-user">${win.name}</span><span class="feed-amount">+$${win.amount.toLocaleString(undefined, {minimumFractionDigits: 2})}</span>`;
                feedContainer.appendChild(item);
            });
        });
    }

    function updateUI(user) {
        document.getElementById('modalOverlay').style.display = 'none';
        document.getElementById('balanceDisplay').style.visibility = 'visible';
        document.getElementById('headerReward').style.display = 'flex';
        document.getElementById('navBal').innerText = `$${user.balance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
        document.getElementById('headerContent').innerHTML = `
            <h1>Welcome back, <span class="highlight">${user.name.toUpperCase()}</span>!</h1>
            <p>Ready to get on that leaderboard???</p>
        `;
        if (window.rewardInterval) clearInterval(window.rewardInterval);
        window.rewardInterval = setInterval(() => updateTimer(user), 1000);
        updateTimer(user);
    }

    function updateTimer(user) {
        const now = Date.now();
        const diff = (24 * 60 * 60 * 1000) - (now - (user.lastBonus || 0));
        const timerText = document.getElementById('headerTimer');
        const rewardBox = document.getElementById('headerReward');
        if (diff > 0) {
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            timerText.innerText = `${h}H ${m}M ${s}S`;
            rewardBox.style.opacity = "0.5"; rewardBox.style.pointerEvents = "none";
        } else {
            timerText.innerText = "Claim $25.00";
            rewardBox.style.opacity = "1"; rewardBox.style.pointerEvents = "auto";
        }
    }

    function claimBonus() {
        db.ref('users/' + currentLocalUser.name.toLowerCase()).transaction(u => {
            if(u){ u.balance += 25; u.lastBonus = Date.now(); }
            return u;
        });
    }

    function switchTab(tabId) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        if(tabId === 'leaderboard') fetchLeaderboard();
    }

    function fetchLeaderboard() {
        const board = document.getElementById('leaderboardBody');
        db.ref('users').on('value', (snap) => {
            let users = [];
            snap.forEach(child => { users.push(child.val()); });
            users.sort((a, b) => b.balance - a.balance);
            board.innerHTML = users.slice(0, 15).map((u, i) => {
                const rankClass = i === 0 ? 'rank-1' : i === 1 ? 'rank-2' : i === 2 ? 'rank-3' : '';
                return `<tr><td><span class="rank-badge ${rankClass}">#${i + 1}</span></td><td>${(u.name || 'Unknown').toUpperCase()}</td><td class="bal-cell">$${(u.balance || 0).toLocaleString(undefined, {minimumFractionDigits: 2})}</td></tr>`;
            }).join('');
        });
    }

    checkAuth();
</script>
</body>
</html>
