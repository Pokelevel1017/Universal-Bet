<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal-Bet | Dice</title>
    <style>
        :root { 
            --dark-blue: #0b1120; --mid-blue: #1e293b; --light-blue: #38bdf8; 
            --accent-green: #00e701; --card-bg: #111827; --text-muted: #94a3b8;
            --danger-red: #ef4444; --hot-orange: #fb923c;
        }

        body { background-color: var(--dark-blue); color: white; font-family: 'Inter', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* NAV */
        nav { background: #070b14; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; height: 75px; border-bottom: 1px solid var(--mid-blue); flex-shrink: 0; z-index: 100; }
        .logo { font-size: 1.5rem; font-weight: 900; letter-spacing: -1px; cursor: pointer; }
        .logo span { color: var(--light-blue); }
        .balance-box { background: var(--mid-blue); padding: 10px 20px; border-radius: 8px; font-weight: 800; color: var(--accent-green); border: 1px solid rgba(56, 189, 248, 0.2); font-size: 1.1rem; }

        /* LAYOUT */
        .main-content { display: flex; flex: 1; overflow: hidden; }

        /* FULL SIDEBAR RESTORED */
        .sidebar { width: 280px; background: #070b14; border-right: 1px solid var(--mid-blue); padding: 20px 12px; display: flex; flex-direction: column; gap: 6px; flex-shrink: 0; overflow-y: auto; }
        .sidebar-label { font-size: 11px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; margin: 20px 0 10px 15px; letter-spacing: 1px; }
        .side-link { padding: 12px 15px; border-radius: 8px; color: var(--text-muted); text-decoration: none; font-weight: 600; transition: 0.2s; display: flex; align-items: center; gap: 12px; font-size: 14px; }
        .side-link:hover, .active-link { background: var(--mid-blue); color: white; }

        /* GAME AREA */
        .game-area { flex: 1; padding: 40px; display: flex; flex-direction: column; align-items: center; background: radial-gradient(circle at top left, #1e293b, #0b1120); overflow-y: auto; }
        .dice-card { width: 100%; max-width: 800px; background: var(--card-bg); padding: 40px; border-radius: 20px; border: 1px solid var(--mid-blue); box-shadow: 0 20px 50px rgba(0,0,0,0.5); }

        /* DICE PRO SYSTEMS */
        .slider-container { position: relative; width: 100%; height: 50px; background: #0f172a; border-radius: 10px; margin: 80px 0 40px 0; border: 4px solid var(--mid-blue); }
        #winZone { position: absolute; height: 100%; background: var(--accent-green); border-radius: 6px; opacity: 0.25; transition: 0.1s; }
        .dice-slider { -webkit-appearance: none; width: 100%; height: 100%; background: transparent; position: relative; z-index: 5; cursor: pointer; }
        .dice-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 45px; height: 65px; background: white; border-radius: 8px; border: 3px solid var(--light-blue); cursor: grab; }
        .roll-marker { position: absolute; top: -65px; transform: translateX(-50%); padding: 10px 15px; border-radius: 8px; font-weight: 900; font-size: 1.4rem; color: white; display: none; z-index: 10; border: 2px solid rgba(255,255,255,0.2); }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; margin-bottom: 30px; }
        .stat-box { background: #0f172a; padding: 15px; border-radius: 12px; border: 1px solid var(--mid-blue); text-align: center; }
        .stat-label { font-size: 11px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; }
        .stat-value { font-size: 1.2rem; font-weight: 900; color: white; }

        .mode-toggle { background: var(--mid-blue); border-radius: 8px; display: flex; padding: 4px; gap: 4px; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 10px; border-radius: 6px; border: none; background: transparent; color: var(--text-muted); font-weight: 800; cursor: pointer; font-size: 12px; }
        .mode-btn.active { background: #334155; color: white; }

        .action-bar { margin-top: 35px; display: flex; flex-direction: column; align-items: center; width: 100%; }
        .bet-box { display: flex; align-items: center; gap: 15px; background: var(--card-bg); padding: 12px 25px; border-radius: 15px; border: 1px solid var(--mid-blue); }
        .bet-box input { background: transparent; border: none; color: white; font-size: 1.5rem; font-weight: 900; width: 120px; text-align: center; outline: none; }
        .btn-deal { padding: 14px 28px; border-radius: 10px; border: none; font-weight: 900; text-transform: uppercase; cursor: pointer; background: var(--light-blue); color: var(--dark-blue); }
    </style>
</head>
<body>

<nav>
    <div class="logo" onclick="location.href='index.html'">UNIVERSAL<span>-BET</span></div>
    <div class="balance-box"><span id="navBal">$0.00</span></div>
</nav>

<div class="main-content">
    <aside class="sidebar">
        <a href="index.html" class="side-link">üè† Home</a>
        <div class="sidebar-label">Games</div>
        <a href="blackjack.html" class="side-link">üÉè Blackjack</a>
        <a href="dice.html" class="side-link active-link">üé≤ Dice</a>
        <a href="mines.html" class="side-link">üí£ Mines</a>
        <a href="roulette.html" class="side-link">üé° Roulette</a>
        <a href="rps.html" class="side-link">‚úä Rock Paper Scissors</a>
        <a href="tower.html" class="side-link">üóº Tower</a>
    </aside>

    <main class="game-area">
        <div class="dice-card">
            <div class="mode-toggle">
                <button class="mode-btn active" id="btnOver" onclick="setMode('over')">Roll Over</button>
                <button class="mode-btn" id="btnUnder" onclick="setMode('under')">Roll Under</button>
            </div>

            <div class="slider-container">
                <div id="winZone"></div>
                <div class="roll-marker" id="rollMarker">50.00</div>
                <input type="range" min="2" max="98" step="0.01" value="50.00" class="dice-slider" id="diceSlider" oninput="updateStats()">
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Multiplier</div>
                    <div class="stat-value" id="multiplier" style="color: var(--hot-orange);">1.7000x</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Win Chance</div>
                    <div class="stat-value" id="winChance">50.00%</div>
                </div>
            </div>

            <div class="action-bar">
                <div class="bet-box">
                    <span style="color:var(--accent-green); font-weight:900;">$</span>
                    <input type="number" id="betAmount" value="10" min="1">
                    <button class="btn-deal" id="rollBtn" onclick="playDice()">Roll Dice</button>
                </div>
            </div>
        </div>
    </main>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDAr9GqIDPWGw0ojEYPL1eigfMeqTGsfT0",
        authDomain: "universalbet-427ce.firebaseapp.com",
        databaseURL: "https://universalbet-427ce-default-rtdb.firebaseio.com",
        projectId: "universalbet-427ce",
        storageBucket: "universalbet-427ce.firebasestorage.app",
        messagingSenderId: "804592033030",
        appId: "1:804592033030:web:352d7f4e8a75fb3f215287"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let user = JSON.parse(localStorage.getItem('currentUser'));
    let mode = 'over';

    function init() {
        if (!user) return window.location.href = 'index.html';
        db.ref('users/' + user.name.toLowerCase()).on('value', s => {
            if(s.exists()){
                user = s.val();
                document.getElementById('navBal').innerText = `$${user.balance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            }
        });
        updateStats();
    }

    function setMode(newMode) {
        mode = newMode;
        document.getElementById('btnOver').classList.toggle('active', mode === 'over');
        document.getElementById('btnUnder').classList.toggle('active', mode === 'under');
        updateStats();
    }

    function updateStats() {
        const slider = document.getElementById('diceSlider');
        const winZone = document.getElementById('winZone');
        const val = parseFloat(slider.value);
        let chance = (mode === 'over') ? (100 - val) : val;
        
        // Lowered Multipliers (85% RTP)
        let mult = (85 / chance);
        if (mult > 20) mult = 20; 
        
        document.getElementById('winChance').innerText = chance.toFixed(2) + '%';
        document.getElementById('multiplier').innerText = mult.toFixed(4) + 'x';

        if(mode === 'over') {
            winZone.style.left = val + '%';
            winZone.style.width = (100 - val) + '%';
        } else {
            winZone.style.left = '0%';
            winZone.style.width = val + '%';
        }
    }

    async function playDice() {
        const bet = parseFloat(document.getElementById('betAmount').value);
        if (bet > user.balance || bet <= 0) return alert("Insufficient Balance");

        const btn = document.getElementById('rollBtn');
        btn.disabled = true;

        const sliderVal = parseFloat(document.getElementById('diceSlider').value);
        const roll = (Math.random() * 100).toFixed(2);
        const marker = document.getElementById('rollMarker');
        
        let chance = (mode === 'over') ? (100 - sliderVal) : sliderVal;
        let mult = (85 / chance);
        if (mult > 20) mult = 20;

        let isWin = (mode === 'over') ? (parseFloat(roll) > sliderVal) : (parseFloat(roll) < sliderVal);
        const profit = isWin ? (bet * mult) - bet : -bet;

        db.ref('users/' + user.name.toLowerCase()).transaction((u) => {
            if (u) u.balance += profit;
            return u;
        }).then(() => {
            marker.style.display = 'block';
            marker.style.left = roll + '%';
            marker.innerText = roll;
            marker.style.background = isWin ? 'var(--accent-green)' : 'var(--danger-red)';
            marker.style.color = isWin ? 'black' : 'white';
            btn.disabled = false;
        });
    }

    init();
</script>
</body>
</html>
