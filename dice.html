<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Universal-Bet | Dice</title>
    <style>
        :root { --dark-blue: #0b1120; --mid-blue: #1e293b; --light-blue: #38bdf8; --win-green: #00e701; --loss-red: #ff4949; }
        body { background-color: var(--dark-blue); color: white; font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; }
        nav { background: #070b14; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; height: 64px; border-bottom: 1px solid var(--mid-blue); }
        .viewport { height: calc(100vh - 64px); display: flex; }
        .sidebar { width: 300px; background: #111827; border-right: 1px solid var(--mid-blue); padding: 24px; display: flex; flex-direction: column; flex-shrink: 0; }
        
        /* FIXED BET BAR STYLE */
        .bet-input-wrapper { background: var(--dark-blue); border: 1px solid var(--mid-blue); border-radius: 8px; padding: 12px; display: flex; align-items: center; margin-bottom: 20px; }
        .bet-input-wrapper input { background: transparent; border: none; color: white; font-weight: 800; width: 100%; outline: none; font-size: 1rem; }
        
        .stage { flex: 1; background: #0f172a; display: flex; align-items: center; justify-content: center; }
        .dice-board { width: 90%; max-width: 800px; background: #1a2434; padding: 60px 40px; border-radius: 20px; position: relative; }
        .dice-result-bubble { position: absolute; top: -35px; left: 50%; transform: translateX(-50%) scale(0); background: #2b384b; padding: 15px 40px; border-radius: 12px; font-size: 2.5rem; font-weight: 900; border: 2px solid var(--mid-blue); opacity: 0; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .dice-result-bubble.show { transform: translateX(-50%) scale(1); opacity: 1; }
        .dice-track-container { position: relative; height: 12px; margin: 60px 0; background: var(--loss-red); border-radius: 10px; }
        #dice-win-bar { background: var(--win-green); height: 100%; position: absolute; border-radius: 10px; transition: 0.2s; }
        .dice-input-range { position: absolute; width: 100%; -webkit-appearance: none; background: transparent; z-index: 10; cursor: pointer; height: 40px; top: -14px; margin: 0; }
        .dice-input-range::-webkit-slider-thumb { -webkit-appearance: none; height: 36px; width: 50px; background: #fff; border-radius: 6px; border: 2px solid var(--light-blue); }
        #roll-pointer { position: absolute; top: 25px; width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-bottom: 20px solid white; transition: left 0.8s cubic-bezier(0.19, 1, 0.22, 1); margin-left: -15px; }
        .btn-main { background: var(--light-blue); color: var(--dark-blue); width: 100%; padding: 16px; border-radius: 8px; font-weight: 800; border: none; cursor: pointer; }
        .mode-toggle { display: flex; background: var(--dark-blue); padding: 4px; border-radius: 8px; margin: 20px 0; border: 1px solid var(--mid-blue); }
        .mode-btn { flex: 1; padding: 10px; border-radius: 6px; border: none; background: transparent; color: #94a3b8; font-weight: 800; cursor: pointer; }
        .mode-btn.active { background: var(--mid-blue); color: white; }
    </style>
</head>
<body>
    <nav><div onclick="location.href='index.html'" style="cursor:pointer; font-weight:900;">UNIVERSAL<span>-BET</span></div><div id="balDisp">$0.00</div></nav>
    <div class="viewport">
        <div class="sidebar">
            <span style="font-size:11px; font-weight:800; color:#94a3b8; margin-bottom:8px; display:block;">BET AMOUNT</span>
            <div class="bet-input-wrapper"><input type="number" id="diceBet" value="10.00"></div>
            <div class="mode-toggle">
                <button id="modeOver" class="mode-btn active" onclick="setDiceMode('over')">Roll Over</button>
                <button id="modeUnder" class="mode-btn" onclick="setDiceMode('under')">Roll Under</button>
            </div>
            <button class="btn-main" onclick="rollDice()">Roll Dice</button>
            <div id="diceStatus" style="text-align:center; font-size:1.5rem; font-weight:900; margin-top:auto;"></div>
        </div>
        <div class="stage">
            <div class="dice-board">
                <div class="dice-result-bubble" id="diceDisplay">50.00</div>
                <div class="dice-track-container">
                    <div id="dice-win-bar"></div>
                    <input type="range" id="diceSlider" class="dice-input-range" min="2" max="98" value="50" oninput="updateDiceUI()">
                    <div id="roll-pointer" style="left: 50%;"></div>
                </div>
                <div style="display:flex; gap:10px;">
                    <div style="flex:1; text-align:center; background:#0b1120; padding:15px; border-radius:10px; border:1px solid var(--mid-blue);">
                        <div style="font-size:11px; color:#94a3b8;">MULTIPLIER</div>
                        <div id="diceMult" style="font-weight:900;">2.0000x</div>
                    </div>
                    <div style="flex:1; text-align:center; background:#0b1120; padding:15px; border-radius:10px; border:1px solid var(--mid-blue);">
                        <div style="font-size:11px; color:#94a3b8;" id="labelMode">ROLL OVER</div>
                        <div id="targetDisplay" style="font-weight:900;">50.00</div>
                    </div>
                    <div style="flex:1; text-align:center; background:#0b1120; padding:15px; border-radius:10px; border:1px solid var(--mid-blue);">
                        <div style="font-size:11px; color:#94a3b8;">WIN CHANCE</div>
                        <div id="diceChance" style="font-weight:900;">50.00%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // SYNC SYSTEM
        let currentUser = JSON.parse(localStorage.getItem('currentUser'));
        let allUsers = JSON.parse(localStorage.getItem('users'));
        if (!currentUser) window.location.href = 'index.html';

        let bal = currentUser.balance, diceMode = 'over';

        function save() { 
            currentUser.balance = bal;
            if (allUsers && allUsers[currentUser.name]) allUsers[currentUser.name].balance = bal;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('users', JSON.stringify(allUsers));
            document.getElementById('balDisp').innerText = `$${bal.toLocaleString(undefined, {minimumFractionDigits:2})}`; 
        }

        function setDiceMode(m) { diceMode = m; document.getElementById('modeOver').classList.toggle('active', m==='over'); document.getElementById('modeUnder').classList.toggle('active', m==='under'); document.getElementById('labelMode').innerText = "ROLL " + m.toUpperCase(); updateDiceUI(); }
        
        function updateDiceUI() {
            const v = parseFloat(document.getElementById('diceSlider').value);
            const winBar = document.getElementById('dice-win-bar');
            let winChance = (diceMode === 'over') ? (100 - v) : v;
            winBar.style.width = winChance + "%";
            winBar.style.left = (diceMode === 'over') ? v + "%" : "0%";
            document.getElementById('targetDisplay').innerText = v.toFixed(2);
            document.getElementById('diceMult').innerText = (99 / winChance).toFixed(4) + 'x';
            document.getElementById('diceChance').innerText = winChance.toFixed(2) + '%';
        }

        function rollDice() {
            const bet = parseFloat(document.getElementById('diceBet').value);
            const target = parseFloat(document.getElementById('diceSlider').value);
            if(bet > bal || bet <= 0) return alert("Insufficient funds!");
            
            bal -= bet; 
            save(); // Save loss immediately

            const bubble = document.getElementById('diceDisplay'); bubble.classList.remove('show');
            setTimeout(() => {
                const roll = (Math.random() * 100).toFixed(2);
                document.getElementById('roll-pointer').style.left = roll + "%";
                bubble.innerText = roll; bubble.classList.add('show');
                let win = (diceMode === 'over' && roll > target) || (diceMode === 'under' && roll < target);
                const status = document.getElementById('diceStatus');
                if(win) {
                    let winChance = (diceMode === 'over') ? (100 - target) : target;
                    bal += bet * (99 / winChance); 
                    status.innerText = "WIN"; 
                    status.style.color = 'var(--win-green)';
                } else { 
                    status.innerText = "LOSS"; 
                    status.style.color = 'var(--loss-red)'; 
                }
                save();
            }, 50);
        }

        // Initialize UI
        save();
        updateDiceUI();
    </script>
</body>
</html>
