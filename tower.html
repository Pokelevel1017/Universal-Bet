<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal-Bet | Tower</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root { 
            --dark-blue: #0b1120; --mid-blue: #1e293b; --light-blue: #38bdf8; 
            --win-green: #00e701; --loss-red: #ff4949; --tile-hover: #2d3a4f;
        }

        body { background-color: var(--dark-blue); color: white; font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; }
        nav { background: #070b14; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; height: 64px; border-bottom: 1px solid var(--mid-blue); }
        .viewport { height: calc(100vh - 64px); display: flex; }

        .sidebar { width: 300px; background: #111827; border-right: 1px solid var(--mid-blue); padding: 24px; display: flex; flex-direction: column; flex-shrink: 0; box-sizing: border-box; }
        .label { font-size: 11px; font-weight: 800; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; display: block; }
        
        .input-wrapper { background: var(--dark-blue); border: 1px solid var(--mid-blue); border-radius: 8px; padding: 12px; margin-bottom: 20px; display: flex; align-items: center; }
        .input-wrapper input, .input-wrapper select { background: transparent; border: none; color: white; font-weight: 800; width: 100%; outline: none; font-size: 1rem; appearance: none; cursor: pointer; }
        select option { background: #111827; }

        .stats-panel { background: #070b14; border-radius: 8px; padding: 15px; margin-bottom: 20px; border: 1px solid var(--mid-blue); }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: 700; }
        .stat-val { color: var(--light-blue); }
        .stat-val.profit { color: var(--win-green); }

        .btn-main { background: var(--light-blue); color: var(--dark-blue); width: 100%; padding: 16px; border-radius: 8px; font-weight: 800; border: none; cursor: pointer; transition: 0.2s; text-transform: uppercase; letter-spacing: 1px; }
        .btn-main:disabled { opacity: 0.4; cursor: not-allowed; }
        .btn-cashout { background: var(--win-green); margin-top: 10px; display: none; }

        .stage { flex: 1; background: #0f172a; display: flex; align-items: center; justify-content: center; position: relative; overflow-y: auto; padding: 40px 0; }
        .tower-container { display: flex; flex-direction: column-reverse; gap: 8px; width: 350px; }
        
        .tower-row { display: flex; gap: 8px; opacity: 0.3; transition: 0.3s; pointer-events: none; position: relative; }
        .tower-row.active { opacity: 1; pointer-events: all; }
        .tower-row.completed { opacity: 0.8; pointer-events: none; }

        .tile { 
            flex: 1; height: 45px; background: var(--mid-blue); border-radius: 4px; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; transition: 0.2s; border: 1px solid transparent;
        }
        .tile:hover { background: var(--tile-hover); border-color: var(--light-blue); }
        .tile.win { background: rgba(0, 231, 1, 0.2) !important; border-color: var(--win-green); }
        .tile.loss { background: rgba(255, 73, 73, 0.2) !important; border-color: var(--loss-red); }
        
        .row-mult { position: absolute; left: -70px; width: 60px; text-align: right; font-size: 12px; font-weight: 900; color: #475569; top: 14px; }
        .tower-row.active .row-mult { color: var(--light-blue); }
        .tower-row.completed .row-mult { color: var(--win-green); }
    </style>
</head>
<body>
    <nav>
        <div onclick="location.href='index.html'" style="cursor:pointer; font-weight:900;">UNIVERSAL<span>-BET</span></div>
        <div id="balDisp">$1,000.00</div>
    </nav>

    <div class="viewport">
        <div class="sidebar">
            <span class="label">Bet Amount</span>
            <div class="input-wrapper"><input type="number" id="tBet" value="10.00"></div>

            <span class="label">Difficulty</span>
            <div class="input-wrapper">
                <select id="tDifficulty" onchange="resetGame()">
                    <option value="easy">Easy (4 Tiles, 1 Bomb)</option>
                    <option value="medium" selected>Medium (3 Tiles, 1 Bomb)</option>
                    <option value="hard">Hard (2 Tiles, 1 Bomb)</option>
                </select>
            </div>

            <div class="stats-panel">
                <div class="stat-row">
                    <span>Current Profit</span>
                    <span id="statProfit" class="stat-val profit">$0.00</span>
                </div>
                <div class="stat-row">
                    <span>Next Tile</span>
                    <span id="statNext" class="stat-val">$0.00</span>
                </div>
            </div>

            <button class="btn-main" id="btnPlay" onclick="startGame()">Start Game</button>
            <button class="btn-main btn-cashout" id="btnCashout" onclick="cashout()">Cash Out</button>
        </div>

        <div class="stage">
            <div class="tower-container" id="towerBoard"></div>
        </div>
    </div>

    <script>
        let bal = 1000, currentLevel = 0, isGameActive = false, currentBet = 0, nonce = 0;
        const towerBoard = document.getElementById('towerBoard');
        const btnPlay = document.getElementById('btnPlay');
        const btnCashout = document.getElementById('btnCashout');

        const config = {
            easy:   { tiles: 4, bombs: 1, mults: [1.31, 1.74, 2.33, 3.10, 4.14, 5.52, 7.36, 9.81, 13.08] },
            medium: { tiles: 3, bombs: 1, mults: [1.47, 2.20, 3.31, 4.96, 7.44, 11.17, 16.75, 25.13, 37.70] },
            hard:   { tiles: 2, bombs: 1, mults: [1.96, 3.92, 7.84, 15.68, 31.36, 62.72, 125.4, 250.8, 501.6] }
        };

        function resetGame() {
            isGameActive = false;
            currentLevel = 0;
            towerBoard.innerHTML = '';
            btnPlay.disabled = false;
            btnCashout.style.display = "none";
            document.getElementById('statProfit').innerText = "$0.00";
            document.getElementById('statNext').innerText = "$0.00";
            
            const diff = document.getElementById('tDifficulty').value;
            const settings = config[diff];

            for (let i = 0; i < settings.mults.length; i++) {
                const row = document.createElement('div');
                row.className = 'tower-row';
                row.id = `row-${i}`;
                
                const multTag = document.createElement('div');
                multTag.className = 'row-mult';
                multTag.innerText = settings.mults[i] + 'x';
                row.appendChild(multTag);

                for (let j = 0; j < settings.tiles; j++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.onclick = () => handlePick(i, j);
                    row.appendChild(tile);
                }
                towerBoard.appendChild(row);
            }
        }

        function startGame() {
            const bet = parseFloat(document.getElementById('tBet').value);
            if (bet > bal || bet <= 0) return;
            
            bal -= bet;
            currentBet = bet;
            isGameActive = true;
            currentLevel = 0;
            nonce++;
            
            updateBal();
            btnPlay.disabled = true;
            btnCashout.style.display = "block";
            
            document.querySelectorAll('.tower-row').forEach(r => r.classList.remove('active', 'completed'));
            document.querySelectorAll('.tile').forEach(t => t.className = 'tile');
            
            document.getElementById(`row-0`).classList.add('active');
            updateStats();
        }

        function updateStats() {
            const diff = document.getElementById('tDifficulty').value;
            const settings = config[diff];
            const currentMult = currentLevel === 0 ? 0 : settings.mults[currentLevel - 1];
            const nextMult = settings.mults[currentLevel];

            document.getElementById('statProfit').innerText = `$${(currentBet * currentMult).toFixed(2)}`;
            document.getElementById('statNext').innerText = `$${(currentBet * nextMult).toFixed(2)}`;
            btnCashout.innerText = currentLevel === 0 ? "SURRENDER" : `CASH OUT $${(currentBet * currentMult).toFixed(2)}`;
        }

        function handlePick(rowIdx, tileIdx) {
            if (!isGameActive || rowIdx !== currentLevel) return;

            const diff = document.getElementById('tDifficulty').value;
            const settings = config[diff];
            
            const combinedSeed = CryptoJS.SHA256(`${serverSeed}:${nonce}:${rowIdx}`).toString();
            const bombPos = parseInt(combinedSeed.substring(0, 2), 16) % settings.tiles;

            const row = document.getElementById(`row-${rowIdx}`);
            const tile = row.children[tileIdx + 1];

            if (tileIdx === bombPos) {
                tile.classList.add('loss');
                gameOver(false);
            } else {
                tile.classList.add('win');
                row.classList.add('completed');
                row.classList.remove('active');
                
                if (currentLevel === settings.mults.length - 1) {
                    currentLevel++;
                    cashout();
                } else {
                    currentLevel++;
                    document.getElementById(`row-${currentLevel}`).classList.add('active');
                    updateStats();
                }
            }
        }

        function cashout() {
            if (!isGameActive) return;
            const diff = document.getElementById('tDifficulty').value;
            const win = currentLevel === 0 ? 0 : currentBet * config[diff].mults[currentLevel - 1];
            bal += win;
            gameOver(true);
        }

        function gameOver(isWin) {
            isGameActive = false;
            btnPlay.disabled = false;
            btnCashout.style.display = "none";
            updateBal();
        }

        function updateBal() {
            document.getElementById('balDisp').innerText = `$${bal.toLocaleString(undefined, {minimumFractionDigits:2})}`;
        }

        const serverSeed = "tower_secret_2026";
        resetGame();
        updateBal();
    </script>
</body>
</html>
